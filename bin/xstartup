#!/bin/sh
if [[ ! -n $VNC2HPC_WM ]] ; then exit -1; fi 
unset SESSION_MANAGER
unset DBUS_SESSION_BUS_ADDRESS
[ -r /etc/profile ] && source /etc/profile
[ -n "$BASH_ENV" ] && source "$BASH_ENV" 
if [[ ${GEOMETRY} == "false" ]] ; then 
    command -v xdpyinfo >/dev/null 2>&1 && \
    geometry=`xdpyinfo | grep dimensions | awk '{print $2}'`
else
    geometry="${GEOMETRY}"
fi

[ -r $HOME/.Xresources ] && \
    xrdb -merge $HOME/.Xresources
[ -r $HOME/.Xresources_$geometry ] && \
    xrdb -merge $HOME/.Xresources_$geometry

#SSH_AGENT=$(which ssh-agent)
#[ -n "$SSH_ASKPASS" ] && eval $($SSH_AGENT) && ssh-add &
# this establishes a default windowing env. 
# The user may have their own clients they want to run.  If they don't,
# fall back to system defaults.
case "$VNC2HPC_WM" in
    berry)
        BERRY_PREFIX="/usr/projects/hpcsoft/common/berry/0.1.7"
        BERRY_BIN="${BERRY_PREFIX}/bin"
        BERRY_LIB="${BERRY_LIB}/lib"
        export PATH=${BERRY_BIN}:${PATH}
        export LD_LIBRARY_PATH=${BERRY_LIB}:${LD_LIBRARY_PATH}
        [ -x /usr/bin/xsetroot ] && /usr/bin/xsetroot -solid '#222E45'
        [ -x /usr/bin/vncconfig ] && /usr/bin/vncconfig -nowin &
        [ -x ${BERRY_BIN}/berry ] && berry
    ;;
    ice*)
        ICEWM_PREFIX="/usr/projects/hpcsoft/common/icewm/$(/usr/projects/hpcsoft/utilities/bin/sys_os)/$(/usr/projects/hpcsoft/utilities/bin/sys_arch)/1.9.2"
        ICEWM_BIN="${ICEWM_PREFIX}/bin"
        ICEWM_LIB="${ICEWM_PREFIX}/lib"
        export PATH=${ICEWM_BIN}:${PATH}
        export LD_LIBRARY_PATH=${ICEWM_LIB}:${LD_LIBRARY_PATH}
        [ -x /usr/bin/xsetroot ] && /usr/bin/xsetroot -solid '#222E45'
        [ -x /usr/bin/vncconfig ] && /usr/bin/vncconfig -nowin &
        [ -x ${ICEWM_BIN}/icewm ] && icewm
    ;;
    fv*)
        FVWM_PATH="/usr/projects/hpcsoft/common/fvwm/$(/usr/projects/hpcsoft/utilities/bin/sys_os)/$(/usr/projects/hpcsoft/utilities/bin/sys_arch)/2.6.9"
        FVWM_BIN="${FVWM_PATH}/bin"
        FVWM_LIB="${FVWM_PATH}/lib"
        export PATH=${FVWM_BIN}:${PATH}
        export LD_LIBRARY_PATH=${FVWM_LIB}:${LD_LIBRARY_PATH}
        [ -x /usr/bin/xsetroot ] && /usr/bin/xsetroot -solid '#222E45'
        [ -x /usr/bin/vncconfig ] && /usr/bin/vncconfig -nowin &
        [ -x ${FVWM_BIN}/fvwm ] && fvwm
    ;;
    mwm|motif*)
        [ -x /usr/bin/xsetroot ] && /usr/bin/xsetroot -solid '#222E45'
        [ -x /usr/bin/vncconfig ] && /usr/bin/vncconfig -nowin &
        [ -x /usr/bin/xterm ] && /usr/bin/xterm &
        [ -x /usr/bin/mwm ] && /usr/bin/mwm 
    ;; 
    openbox*)
        OBX_PATH="/usr/projects/hpcsoft/common/openbox/$(/usr/projects/hpcsoft/utilities/bin/sys_os)/$(/usr/projects/hpcsoft/utilities/bin/sys_arch)/3.6.1"
        OBX_BIN="${OBX_PATH}/bin"
        OBX_LIB="${OBX_PATH}/lib"
        export PATH=${OBX_BIN}:${PATH}
        export LD_LIBRARY_PATH=${OBX_LIB}:${LD_LIBRARY_PATH}
        [ -x /usr/bin/xsetroot ] && /usr/bin/xsetroot -solid '#222E45'
        [ -x /usr/bin/vncconfig ] && /usr/bin/vncconfig -nowin &
        [ -x /usr/bin/xterm ] && /usr/bin/xterm &
        [ -x ${OBX_BIN}/openbox-session ] && openbox-session
    ;;
    xfwm4)
        [ -x /usr/bin/xsetroot ] && /usr/bin/xsetroot -solid '#222E45'
        [ -x /usr/bin/vncconfig ] && /usr/bin/vncconfig -nowin &
        [ -x /usr/bin/xterm ] && /usr/bin/xterm &
        [ -x /usr/bin/xfwm4 ] && /usr/bin/xfwm4
    ;;
    *)
        "echo UNSUPPORTED $1"
        exit 1 ;
    ;;
esac
